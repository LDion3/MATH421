---
output: # rmarkdown::github_document
  pdf_document: default
  word_document: default
  html_document:
title: "Assignment 4.  Data Wrangling with Dplyr"
author: "Louis Dion"
date: "September 23, 2019"
---
This assignment assumes that you have taken the `Introduction to the Tidyverse
` and `Data Manipulation with dplyr in R` course at Datacamp. You can use base R functions and dplyr functions in the assignment.

***Submission Instruction***.  You will need to submit on **Blackboard**, in the **Assignment** section, the follows:

- A knitted pdf
- A link to the markdown document in your Github
- A link to the pdf document in your Github

Questions
---
```{r}
library(dplyr)
```

1. Compute the follows using `%>%` operator. **Notice that** 

  - `x %>% f = f(x)`,
  - `x %>% f %>% g = g(f(x))` and 
  - `x %>% f(y) = f(x,y)`
  
  a. $\sin(2019)$
```{r}
2019%>%sin
```
  b. $\sin(\cos(2019))$ 
```{r}
2019%>%cos%>%sin
```
  c. $\sin(\cos(\tan(\log(2019))))$ 
```{r}
2019%>%log%>%tan%>%cos%>%sin
```
  d. $\log_2(2019)$
```{r}
2019%>%log2
```
2. Fixing the `SEX`, `AGE` and `TRAV_SP` following the steps in Assignment 2 (This time, do it on the entire dataset instead of the sample dataset). 
#Bring in dataset
```{r}
library(readxl)
c2015<-read_excel('C:/Users/student/Documents/MATH421/data/c2015.xlsx')
```
#Change Unknown and Not Rep to NA
```{r}
c2015<-c2015%>%replace(.,c2015=='Unknown'|c2015=='Not Rep',NA)
```
#Fix SEX variable
```{r}
c2015<-c2015%>%mutate(SEX=replace(SEX,is.na(SEX),'Female'))
```
#Fix AGE variable
```{r}
c2015<-c2015%>%mutate(AGE=replace(AGE,AGE=='Less than 1','0'),AGE=as.numeric(AGE),AGE=replace(AGE,is.na(AGE),mean(AGE,na.rm=TRUE)))
```
#Fix TRAV_SP variable
```{r}
library(stringr)
c2015<-c2015%>%mutate(TRAV_SP=sapply(strsplit(TRAV_SP,split=" ",fixed = TRUE),function(x) (x[1])), TRAV_SP=as.numeric(TRAV_SP))
```
3. Calculate the average age and average speed of female in the accident happened in the weekend. 
```{r}
femweekend<-c2015%>%filter(SEX=='Female',DAY_WEEK=='Saturday'|DAY_WEEK=='Sunday')%>%summarize(age=mean(AGE,na.rm=1),speed=mean(TRAV_SP,na.rm=1))
femweekend
```

_Notice: These questions are to practice `select_if` and `summarise_if`, `summarise_all`... functions in dplyr Check out the uses of these functions [here](https://dplyr.tidyverse.org/reference/select_all.html) and [here](https://dplyr.tidyverse.org/reference/summarise_all.html)._


4. Use `select_if` and `is.numeric` functions to create a dataset with only numeric variables. Print out the names of all numeric variables
```{r}
number<-c2015%>%select_if(is.numeric)
number%>%names
```

5. Calculate the mean of all numeric variables using `select_if` and `summarise_all` 
```{r}
number%>%summarize_all(.,mean,na.rm=1)
```

6. We can shortcut 3 and 4 by using `summarise_if`:  Use `summarise_if` to Calculate the mean of all numeric variables. (You may need to use `na.rm = TRUE` to ignore the NAs)
```{r}
c2015%>%summarise_if(is.numeric, mean, na.rm = TRUE)
```
7. Use `summarise_if` to calculate the median of all numeric variables.
```{r}
c2015%>%summarise_if(is.numeric, median, na.rm = TRUE)
```
8. Use `summarise_if` to calculate the standard deviation of all numeric variables. (`sd` function for standard deviation)
```{r}
c2015%>%summarise_if(is.numeric, sd, na.rm = TRUE)
```
9. Use `summarise_if` to calculate the number of missing values for each numeric variables. *Hint:* Use `~sum(is.na(.))` 
```{r}
c2015%>%summarise_if(is.numeric, ~sum(is.na(.)))
```
10. Calculate the `log` of the average for each numeric variable. 
```{r}
c2015%>%summarise_if(is.numeric, ~log(mean(.,na.rm=TRUE)))
```
11. You will notice that there is one NA is produced in 10. Fix this by calculating the log of the absolute value average for each numeric variable. 
```{r}
c2015%>%summarise_if(is.numeric,~log(abs(mean(.,na.rm=TRUE))))
```
12. Calculate the number of missing values for each categorical variables using `summarise_if`
```{r}
c2015%>%summarise_if(is.character,~sum(is.na(.)))
```
13. Calculate the number of missing values for each categorical variables using `summarise_all`
```{r}
c2015%>%select_if(is.character)%>%summarize_all(~sum(is.na(.)))
```
14. Calculate the number of states in the dataset. **Hint: You can use `length(table())`
```{r}
length(table(c2015$STATE))
#There are 51 "States" in the dataset, the 50 actual states and presumably Puerto Rico.
```
15. Calculate the number of uniques values for each categorical variables using `summarise_if`.
```{r}
c2015%>%summarize_if(is.character,~length(table(.)))
```
16. Calculate the number of uniques values for each categorical variables using `summarise_all`.
```{r}
c2015%>%select_if(is.character)%>%summarize_all(~length(table(.)))
```
17. Print out the names of all variables that have more than 30 distinct values
```{r}
thirty<-c2015%>%select_if(~length(table(.))>30)
thirty%>%names
```
18. Print out the names of all categorical variables that more than 30 distinct values
```{r}
thirty%>%select_if(is.character)%>%names
```
19. Print out the names of all numeric variables that has the maximum values greater than 30
```{r}
#using number dataset created above
number%>%summarize_all(~max(.,na.rm=TRUE))
#saw hour has value of 99, going to replace that with NA before printing names since there is no hour 99
number<-number%>%mutate(HOUR=replace(HOUR,HOUR==99,NA))
number%>%select_if(~max(.,na.rm=TRUE)>30)%>%names
```
20. Calculate the mean of all numeric variables that has the maximum values greater than 30 using `summarise_if'
```{r}
number%>%summarize_if(~max(.,na.rm=TRUE)>30,mean,na.rm=TRUE)
```
21. Calculate the mean of all numeric variables that has the maximum values greater than 30 using `summarise_all'
```{r}
number%>%select_if(~max(.,na.rm=TRUE)>30)%>%summarize_all(~mean(.,na.rm=TRUE))
```
22. Create a dataset containing variables with standard deviation greater than 10. Call this data `d1` 
```{r}
d1<-number%>%select_if(~sd(.,na.rm=TRUE)>10.0)
d1
```
23. Centralizing a variable is subtract it by its mean. Centralize the variables of `d1` using `mutate_all`. Check the means of all centralized variables to confirm that they are all zeros. 
```{r}
d1<-d1%>%mutate_all(.,~(.-mean(.,na.rm=TRUE)))
d1%>%summarize_all(~mean(.,na.rm=TRUE))
#all means in the dataset are at 0.
```
24. Standarizing a variable is to subtract it to its mean and then divide by its standard deviation.  Standardize the variables of `d1` using `mutate_all`. Check the means and standard deviation of all centralized variables to confirm that they are all zeros (for the means) and ones (for standard deviation). 
```{r}
d1<-d1%>%mutate_all(.,~(./sd(.,na.rm=TRUE)))
d1%>%summarize_all(~mean(.,na.rm=TRUE))
#all means are 0
d1%>%summarize_all(~sd(.,na.rm=TRUE))
#all standard deviations are 1
```


